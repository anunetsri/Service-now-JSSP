"use strict";require("core-js/modules/es.object.to-string"),require("core-js/modules/es.promise"),require("core-js/modules/web.queue-microtask"),require("regenerator-runtime/runtime");var e,t,r,s,n,o=(e=require("ava"))&&"object"==typeof e&&"default"in e?e.default:e;function a(e,t,r,s,n,o,a){try{var i=e[o](a),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(s,n)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(s,n){var o=e.apply(t,r);function i(e){a(o,s,n,i,u,"next",e)}function u(e){a(o,s,n,i,u,"throw",e)}i(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function p(e,t){global[e]=t}require("@k2oss/k2-broker-core/test-framework"),require("./index"),o("describe returns the hardcoded instance",(t=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,p("postSchema",(function(e){r=e})),e.next=4,Promise.resolve(ondescribe());case 4:t.deepEqual(r,{objects:{todo:{displayName:"TODO",description:"Manages a TODO list",properties:{id:{displayName:"ID",type:"number"},userId:{displayName:"User ID",type:"number"},title:{displayName:"Title",type:"string"},completed:{displayName:"Completed",type:"boolean"}},methods:{get:{displayName:"Get TODO",type:"read",inputs:["id"],outputs:["id","userId","title","completed"]},getParams:{displayName:"Get TODO",type:"read",parameters:{pid:{displayName:"param1",description:"Description Of Param 1",type:"number"}},requiredParameters:["pid"],outputs:["id"]}}}}}),t.pass();case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})),o("execute fails with the wrong parameters",(r=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.throwsAsync(Promise.resolve(onexecute({objectName:"test1",methodName:"unused",parameters:{},properties:{},schema:{}})));case 2:return r=e.sent,t.deepEqual(r.message,"The object test1 is not supported."),e.next=6,t.throwsAsync(Promise.resolve(onexecute({objectName:"todo",methodName:"test2",parameters:{},properties:{},schema:{}})));case 6:r=e.sent,t.deepEqual(r.message,"The method test2 is not supported."),t.pass();case 9:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})),o("execute passes with method params",(s=i(regeneratorRuntime.mark((function e(t){var r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e){r=e},r=null,p("postResult",s),e.next=5,Promise.resolve(onexecute({objectName:"todo",methodName:"getParams",parameters:{pid:456},properties:{},configuration:{},schema:{}}));case 5:t.deepEqual(r,{id:456}),t.pass();case 7:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})),o("execute passes",(n=i(regeneratorRuntime.mark((function e(t){var r,s,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){s=e},r=null,p("XMLHttpRequest",function(){function e(){u(this,e),r=this.recorder={},this.recorder.headers={}}var t,s,n;return t=e,(s=[{key:"open",value:function(e,t){this.recorder.opened={method:e,url:t}}},{key:"setRequestHeader",value:function(e,t){this.recorder.headers[e]=t}},{key:"send",value:function(){var e=this;queueMicrotask((function(){e.readyState=4,e.status=200,e.responseText=JSON.stringify({id:123,userId:51,title:"Groceries",completed:!1}),e.onreadystatechange(),delete e.responseText}))}}])&&c(t.prototype,s),n&&c(t,n),e}()),s=null,p("postResult",n),e.next=8,Promise.resolve(onexecute({objectName:"todo",methodName:"get",parameters:{},properties:{id:123},configuration:{},schema:{}}));case 8:t.deepEqual(r,{opened:{method:"GET",url:"https://jsonplaceholder.typicode.com/todos/123"},headers:{test:"test value"}}),t.deepEqual(s,{id:123,userId:51,title:"Groceries",completed:!1}),t.pass();case 11:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}));
//# sourceMappingURL=ServiceNow.js.map
